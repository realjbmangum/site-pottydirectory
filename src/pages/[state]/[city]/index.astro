---
import BaseLayout from '../../../layouts/BaseLayout.astro';
import Breadcrumb from '../../../components/Breadcrumb.astro';
import VendorCard from '../../../components/VendorCard.astro';
import VendorFilter from '../../../components/VendorFilter.astro';
import AdSlot from '../../../components/AdSlot.astro';
import states from '../../../data/states.json';
import topCities from '../../../data/top-cities.json';
import { getAllCitiesWithState, getVendorsByCity, getCityContent, type CityContent } from '../../../lib/supabase';
import { citySlug, cityFromSlug } from '../../../lib/utils';

export async function getStaticPaths() {
  // Get cities that have vendors in the database
  let citiesWithVendors: { city: string; state: string; count: number }[] = [];
  try {
    citiesWithVendors = await getAllCitiesWithState();
  } catch (error) {
    console.error('Error fetching cities:', error);
  }

  // Create a Set of existing city-state combinations for quick lookup
  const existingCities = new Set(
    citiesWithVendors.map(c => `${c.city}-${c.state}`)
  );

  // Build paths for all top cities from each state
  const allPaths: Array<{
    params: { state: string; city: string };
    props: { stateName: string; stateSlug: string; stateAbbr: string; cityName: string; citySlugValue: string };
  }> = [];

  // Add all top cities for each state
  for (const stateInfo of states) {
    const stateCities = (topCities as Record<string, string[]>)[stateInfo.name] || [];

    for (const city of stateCities) {
      allPaths.push({
        params: {
          state: stateInfo.slug,
          city: citySlug(city)
        },
        props: {
          stateName: stateInfo.name,
          stateSlug: stateInfo.slug,
          stateAbbr: stateInfo.abbr,
          cityName: city,
          citySlugValue: citySlug(city)
        }
      });
    }
  }

  // Add any cities with vendors that aren't already in our list
  for (const cityData of citiesWithVendors) {
    const stateInfo = states.find(s => s.name === cityData.state);
    const stateCities = (topCities as Record<string, string[]>)[cityData.state] || [];

    // Only add if not already in top cities
    if (!stateCities.includes(cityData.city)) {
      allPaths.push({
        params: {
          state: stateInfo?.slug || cityData.state.toLowerCase().replace(/\s+/g, '-'),
          city: citySlug(cityData.city)
        },
        props: {
          stateName: cityData.state,
          stateSlug: stateInfo?.slug || cityData.state.toLowerCase().replace(/\s+/g, '-'),
          stateAbbr: stateInfo?.abbr || '',
          cityName: cityData.city,
          citySlugValue: citySlug(cityData.city)
        }
      });
    }
  }

  return allPaths;
}

const { stateName, stateSlug, stateAbbr, cityName, citySlugValue } = Astro.props;

let vendors = [];
try {
  vendors = await getVendorsByCity(stateName, cityName);
} catch (error) {
  console.error('Error fetching vendors:', error);
}

// Fetch SEO city content
let cityContent: CityContent | null = null;
try {
  cityContent = await getCityContent(cityName, stateName);
} catch (error) {
  console.error('Error fetching city content:', error);
}

const breadcrumbs = [
  { label: 'Home', href: '/' },
  { label: stateName, href: `/${stateSlug}/` },
  { label: cityName }
];

// Regional pricing variations (approximate based on cost of living)
const highCostStates = ['California', 'New York', 'Massachusetts', 'Connecticut', 'New Jersey', 'Hawaii', 'Alaska', 'Washington', 'Oregon', 'Colorado'];
const lowCostStates = ['Mississippi', 'Arkansas', 'Oklahoma', 'Kansas', 'Missouri', 'Alabama', 'Kentucky', 'West Virginia', 'Louisiana', 'Tennessee'];

const isHighCost = highCostStates.includes(stateName);
const isLowCost = lowCostStates.includes(stateName);

const priceRange = {
  standard: isHighCost ? '$175-275' : isLowCost ? '$100-175' : '$125-200',
  deluxe: isHighCost ? '$225-350' : isLowCost ? '$150-250' : '$175-275',
  ada: isHighCost ? '$250-400' : isLowCost ? '$175-300' : '$200-325',
  trailer: isHighCost ? '$800-1,500' : isLowCost ? '$500-1,000' : '$600-1,200',
};

// Get services offered by vendors in this city
const servicesOffered = vendors.length > 0
  ? [...new Set(vendors.flatMap(v => v.services_offered || []))].slice(0, 6)
  : ['Standard Porta Potties', 'Deluxe Units', 'ADA Accessible', 'Luxury Trailers', 'Hand Wash Stations', 'Holding Tanks'];
---

<BaseLayout
  title={`Porta Potty Rentals in ${cityName}, ${stateAbbr} | ${vendors.length} Local Providers`}
  description={`Find ${vendors.length} portable restroom rental companies in ${cityName}, ${stateName}. Compare local porta potty providers for construction, events, weddings, and more.`}
  noindex={vendors.length === 0}
>
  <!-- Hero -->
  <section class="relative min-h-[350px] flex items-center overflow-hidden">
    <div class="absolute inset-0">
      <img src="/images/herotile.jpeg" alt="" class="w-full h-full object-cover" />
      <div class="absolute inset-0 bg-gradient-to-r from-slate-900/95 via-primary-900/90 to-slate-900/80"></div>
      <div class="absolute inset-0 bg-gradient-to-t from-slate-900 via-transparent to-slate-900/50"></div>
    </div>
    <div class="relative max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-12 w-full">
      <Breadcrumb items={breadcrumbs} />
      <div class="mt-6">
        <div class="inline-flex items-center bg-white/10 backdrop-blur-sm rounded-full px-4 py-2 mb-4">
          <svg class="w-5 h-5 text-primary-400 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z" />
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z" />
          </svg>
          <span class="text-sm font-medium text-white">{cityName}, {stateAbbr}</span>
        </div>
        <h1 class="text-4xl md:text-5xl lg:text-6xl font-bold mb-4 text-white">
          Porta Potty Rentals in {cityName}, {stateAbbr}
        </h1>
        <p class="text-xl text-blue-100 max-w-2xl mb-6">
          {vendors.length > 0
            ? `Compare ${vendors.length} portable restroom ${vendors.length === 1 ? 'provider' : 'providers'} in ${cityName}`
            : `Find porta potty rental companies in ${cityName}`}
        </p>
        {vendors.length > 0 && (
          <div class="flex flex-wrap gap-4 text-sm">
            <div class="flex items-center bg-white/10 backdrop-blur-sm rounded-lg px-4 py-2">
              <span class="text-2xl font-bold text-white mr-2">{vendors.length}</span>
              <span class="text-blue-200">Local Providers</span>
            </div>
            <div class="flex items-center bg-white/10 backdrop-blur-sm rounded-lg px-4 py-2">
              <svg class="w-5 h-5 text-green-400 mr-2" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd" />
              </svg>
              <span class="text-blue-200">Verified Listings</span>
            </div>
            <div class="flex items-center bg-white/10 backdrop-blur-sm rounded-lg px-4 py-2">
              <svg class="w-5 h-5 text-green-400 mr-2" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd" />
              </svg>
              <span class="text-blue-200">Free Quotes</span>
            </div>
          </div>
        )}
      </div>
    </div>
  </section>

  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-12">
    <!-- Ad -->
    <div class="mb-8">
      <AdSlot slot="header" />
    </div>

    {vendors.length > 0 ? (
      <>
        <VendorFilter totalCount={vendors.length} />
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6" data-vendor-grid style="display: grid;">
          {vendors.map((vendor) => (
            <VendorCard vendor={vendor} citySlug={citySlugValue} stateSlug={stateSlug} />
          ))}
        </div>
      </>
    ) : (
      <div class="bg-white rounded-xl border border-gray-200 p-8 md:p-12">
        <div class="max-w-2xl mx-auto text-center">
          <img src="/images/PottyDirectory_Logo.png" alt="" class="w-20 h-20 mx-auto mb-6" />
          <h2 class="text-2xl font-bold text-gray-900 mb-4">
            Porta Potty Rentals Coming to {cityName}
          </h2>
          <p class="text-gray-600 mb-8 leading-relaxed">
            We're actively building our directory of portable restroom rental companies in {cityName}, {stateAbbr}.
            Check back soon or be the first provider listed in this area!
          </p>

          <div class="flex flex-col sm:flex-row gap-4 justify-center mb-10">
            <a
              href="/submit/"
              class="inline-flex items-center justify-center bg-primary-600 text-white px-6 py-3 rounded-lg font-medium hover:bg-primary-700 transition-colors"
            >
              <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6" />
              </svg>
              List Your Business
            </a>
            <a
              href={`/${stateSlug}/`}
              class="inline-flex items-center justify-center border-2 border-gray-300 text-gray-700 px-6 py-3 rounded-lg font-medium hover:bg-gray-50 transition-colors"
            >
              Browse Other {stateName} Cities
            </a>
          </div>

          <!-- What to expect section -->
          <div class="text-left bg-gray-50 rounded-xl p-6">
            <h3 class="font-semibold text-gray-900 mb-4">What services will be available in {cityName}?</h3>
            <ul class="space-y-3 text-gray-600">
              <li class="flex items-start">
                <svg class="w-5 h-5 text-primary-500 mr-3 mt-0.5 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
                </svg>
                <span>Standard porta potty rentals for construction sites</span>
              </li>
              <li class="flex items-start">
                <svg class="w-5 h-5 text-primary-500 mr-3 mt-0.5 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
                </svg>
                <span>Luxury restroom trailers for weddings and events</span>
              </li>
              <li class="flex items-start">
                <svg class="w-5 h-5 text-primary-500 mr-3 mt-0.5 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
                </svg>
                <span>ADA-compliant handicap accessible units</span>
              </li>
              <li class="flex items-start">
                <svg class="w-5 h-5 text-primary-500 mr-3 mt-0.5 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
                </svg>
                <span>Hand washing stations and sanitizer dispensers</span>
              </li>
            </ul>
          </div>
        </div>
      </div>
    )}

    <!-- Pricing Guide Section -->
    <div class="mt-12 bg-white rounded-xl border border-gray-200 p-8">
      <h2 class="text-2xl font-bold text-gray-900 mb-2">
        Porta Potty Rental Prices in {cityName}
      </h2>
      <p class="text-gray-600 mb-6">
        Average weekly rental rates for {cityName}, {stateAbbr}. Prices vary based on rental duration, delivery distance, and servicing frequency.
      </p>

      <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-6">
        <div class="bg-gray-50 rounded-lg p-4 text-center">
          <p class="text-sm text-gray-500 mb-1">Standard Unit</p>
          <p class="text-xl font-bold text-gray-900">{priceRange.standard}</p>
          <p class="text-xs text-gray-500">per week</p>
        </div>
        <div class="bg-gray-50 rounded-lg p-4 text-center">
          <p class="text-sm text-gray-500 mb-1">Deluxe Unit</p>
          <p class="text-xl font-bold text-gray-900">{priceRange.deluxe}</p>
          <p class="text-xs text-gray-500">per week</p>
        </div>
        <div class="bg-gray-50 rounded-lg p-4 text-center">
          <p class="text-sm text-gray-500 mb-1">ADA Accessible</p>
          <p class="text-xl font-bold text-gray-900">{priceRange.ada}</p>
          <p class="text-xs text-gray-500">per week</p>
        </div>
        <div class="bg-gray-50 rounded-lg p-4 text-center">
          <p class="text-sm text-gray-500 mb-1">Luxury Trailer</p>
          <p class="text-xl font-bold text-gray-900">{priceRange.trailer}</p>
          <p class="text-xs text-gray-500">per event</p>
        </div>
      </div>

      <p class="text-sm text-gray-500">
        * Prices are estimates based on {stateName} market rates. Contact providers directly for accurate quotes.
        <a href="/pricing/" class="text-primary-600 hover:underline ml-1">View full pricing guide →</a>
      </p>
    </div>

    <!-- Services Available Section -->
    <div class="mt-8 bg-white rounded-xl border border-gray-200 p-8">
      <h2 class="text-2xl font-bold text-gray-900 mb-6">
        Portable Restroom Services in {cityName}
      </h2>

      <div class="grid md:grid-cols-2 gap-8">
        <div>
          <h3 class="font-semibold text-gray-900 mb-4">Available Services</h3>
          <ul class="space-y-3">
            {servicesOffered.map((service) => (
              <li class="flex items-center text-gray-600">
                <svg class="w-5 h-5 text-green-500 mr-3 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
                </svg>
                {service}
              </li>
            ))}
          </ul>
        </div>

        <div>
          <h3 class="font-semibold text-gray-900 mb-4">Common Uses in {cityName}</h3>
          <ul class="space-y-3">
            <li class="flex items-start text-gray-600">
              <svg class="w-5 h-5 text-primary-500 mr-3 mt-0.5 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4" />
              </svg>
              <span><strong>Construction Sites</strong> - OSHA-compliant units for work crews</span>
            </li>
            <li class="flex items-start text-gray-600">
              <svg class="w-5 h-5 text-primary-500 mr-3 mt-0.5 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 15.546c-.523 0-1.046.151-1.5.454a2.704 2.704 0 01-3 0 2.704 2.704 0 00-3 0 2.704 2.704 0 01-3 0 2.704 2.704 0 00-3 0 2.704 2.704 0 01-3 0 2.701 2.701 0 00-1.5-.454M9 6v2m3-2v2m3-2v2M9 3h.01M12 3h.01M15 3h.01M21 21v-7a2 2 0 00-2-2H5a2 2 0 00-2 2v7h18zm-3-9v-2a2 2 0 00-2-2H8a2 2 0 00-2 2v2h12z" />
              </svg>
              <span><strong>Weddings & Parties</strong> - Luxury trailers for special events</span>
            </li>
            <li class="flex items-start text-gray-600">
              <svg class="w-5 h-5 text-primary-500 mr-3 mt-0.5 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z" />
              </svg>
              <span><strong>Festivals & Events</strong> - High-capacity solutions for crowds</span>
            </li>
            <li class="flex items-start text-gray-600">
              <svg class="w-5 h-5 text-primary-500 mr-3 mt-0.5 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6" />
              </svg>
              <span><strong>Home Renovations</strong> - Temporary restrooms during remodeling</span>
            </li>
          </ul>
        </div>
      </div>
    </div>

    <!-- How to Choose Section -->
    <div class="mt-8 bg-primary-50 rounded-xl p-8">
      <h2 class="text-2xl font-bold text-gray-900 mb-6">
        How to Choose a Porta Potty Provider in {cityName}
      </h2>

      <div class="grid md:grid-cols-3 gap-6">
        <div class="bg-white rounded-lg p-5">
          <div class="w-10 h-10 bg-primary-100 rounded-full flex items-center justify-center mb-4">
            <span class="text-primary-600 font-bold">1</span>
          </div>
          <h3 class="font-semibold text-gray-900 mb-2">Get Multiple Quotes</h3>
          <p class="text-gray-600 text-sm">
            Contact 2-3 providers to compare prices. Ask about delivery fees, servicing schedules, and any extra charges.
          </p>
        </div>
        <div class="bg-white rounded-lg p-5">
          <div class="w-10 h-10 bg-primary-100 rounded-full flex items-center justify-center mb-4">
            <span class="text-primary-600 font-bold">2</span>
          </div>
          <h3 class="font-semibold text-gray-900 mb-2">Check Service Area</h3>
          <p class="text-gray-600 text-sm">
            Confirm the provider services {cityName} directly. Some may charge extra for delivery outside their core area.
          </p>
        </div>
        <div class="bg-white rounded-lg p-5">
          <div class="w-10 h-10 bg-primary-100 rounded-full flex items-center justify-center mb-4">
            <span class="text-primary-600 font-bold">3</span>
          </div>
          <h3 class="font-semibold text-gray-900 mb-2">Ask About Servicing</h3>
          <p class="text-gray-600 text-sm">
            Weekly servicing is standard, but high-traffic events may need more frequent cleaning. Clarify what's included.
          </p>
        </div>
      </div>

      <div class="mt-6 text-center">
        <a href="/calculator/" class="inline-flex items-center text-primary-700 font-medium hover:text-primary-800">
          <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 7h6m0 10v-3m-3 3h.01M9 17h.01M9 14h.01M12 14h.01M15 11h.01M12 11h.01M9 11h.01M7 21h10a2 2 0 002-2V5a2 2 0 00-2-2H7a2 2 0 00-2 2v14a2 2 0 002 2z" />
          </svg>
          Use our calculator to find out how many units you need →
        </a>
      </div>
    </div>

    <!-- FAQ Section -->
    <div class="mt-8 bg-white rounded-xl border border-gray-200 p-8">
      <h2 class="text-2xl font-bold text-gray-900 mb-6">
        Frequently Asked Questions
      </h2>

      <div class="space-y-6">
        <div>
          <h3 class="font-semibold text-gray-900 mb-2">How far in advance should I book a porta potty in {cityName}?</h3>
          <p class="text-gray-600">
            For standard rentals, 1-2 weeks notice is usually sufficient. For large events, weddings, or peak season (spring and summer),
            we recommend booking 3-4 weeks ahead to ensure availability of your preferred unit type.
          </p>
        </div>

        <div>
          <h3 class="font-semibold text-gray-900 mb-2">What's included in a typical porta potty rental?</h3>
          <p class="text-gray-600">
            Most rentals include delivery, setup, weekly servicing (pumping, cleaning, restocking supplies), and pickup.
            Some providers include hand sanitizer; others charge extra. Always confirm what's included in your quote.
          </p>
        </div>

        <div>
          <h3 class="font-semibold text-gray-900 mb-2">How many porta potties do I need?</h3>
          <p class="text-gray-600">
            A general rule is 1 unit per 50-100 guests for a 4-hour event. Construction sites typically need 1 unit per 10 workers.
            Add more if serving alcohol, for all-day events, or if you expect a majority female crowd.
            <a href="/blog/how-many-porta-potties-do-i-need/" class="text-primary-600 hover:underline ml-1">Read our full guide →</a>
          </p>
        </div>

        <div>
          <h3 class="font-semibold text-gray-900 mb-2">Do I need a permit for a porta potty in {cityName}?</h3>
          <p class="text-gray-600">
            Permit requirements vary by location. For private property (home, business), you typically don't need a permit.
            For events on public property or large gatherings, check with {cityName} city offices. Your rental provider can often advise on local requirements.
          </p>
        </div>
      </div>
    </div>

    <!-- Local SEO Content - Enhanced -->
    <div class="mt-8 bg-gray-50 rounded-xl p-8">
      <h2 class="text-2xl font-bold text-gray-900 mb-4">
        About Porta Potty Rentals in {cityName}, {stateName}
      </h2>

      {cityContent?.intro_paragraph ? (
        <>
          <p class="text-gray-600 mb-4">{cityContent.intro_paragraph}</p>

          {cityContent.local_tips && (
            <div class="bg-white rounded-lg border border-gray-200 p-4 mb-4">
              <h3 class="font-semibold text-gray-900 mb-2 flex items-center">
                <svg class="w-5 h-5 text-primary-500 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                </svg>
                Local Tips
              </h3>
              <p class="text-gray-600 text-sm">{cityContent.local_tips}</p>
            </div>
          )}

          {cityContent.peak_season && (
            <div class="bg-amber-50 rounded-lg border border-amber-200 p-4 mb-4">
              <h3 class="font-semibold text-amber-800 mb-2 flex items-center">
                <svg class="w-5 h-5 text-amber-600 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
                </svg>
                Peak Season
              </h3>
              <p class="text-amber-700 text-sm">{cityContent.peak_season}</p>
            </div>
          )}

          {cityContent.popular_for && cityContent.popular_for.length > 0 && (
            <div class="flex flex-wrap gap-2 mb-4">
              <span class="text-sm text-gray-500">Popular for:</span>
              {cityContent.popular_for.map((use: string) => (
                <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-primary-100 text-primary-800">
                  {use}
                </span>
              ))}
            </div>
          )}
        </>
      ) : (
        <>
          <p class="text-gray-600 mb-4">
            Finding reliable portable restroom rentals in {cityName} doesn't have to be difficult. Our directory connects you with
            {vendors.length > 0 ? ` ${vendors.length} verified local providers` : ' trusted providers'} offering everything from basic
            construction site units to luxury restroom trailers for upscale events.
          </p>
          <p class="text-gray-600 mb-4">
            {cityName} residents and businesses commonly rent porta potties for construction projects, outdoor weddings,
            community festivals, sporting events, and home renovations. With {stateName}'s {isHighCost ? 'higher cost of living' : isLowCost ? 'competitive pricing' : 'moderate pricing'},
            you can expect rental rates {isHighCost ? 'on the higher end of the national average' : isLowCost ? 'below the national average' : 'close to the national average'}.
          </p>
        </>
      )}

      <p class="text-gray-600">
        All providers in our {cityName} directory are verified for legitimacy and service quality. We confirm contact information,
        check service areas, and monitor customer feedback to ensure you're connecting with reputable companies.
        <a href="/about/" class="text-primary-600 hover:underline ml-1">Learn about our verification process →</a>
      </p>
    </div>

    <!-- CTA Section -->
    <div class="mt-8 bg-primary-600 rounded-xl p-8 text-center text-white">
      <h2 class="text-2xl font-bold mb-3">Need Porta Potty Rentals in {cityName}?</h2>
      <p class="text-primary-100 mb-6 max-w-2xl mx-auto">
        {vendors.length > 0
          ? `Compare ${vendors.length} local providers and get quotes today. Contact multiple companies to find the best price and service for your needs.`
          : `We're building our network of providers in ${cityName}. Check back soon or browse nearby cities.`
        }
      </p>
      <div class="flex flex-col sm:flex-row gap-4 justify-center">
        {vendors.length > 0 ? (
          <a href="#" onclick="window.scrollTo({top: 0, behavior: 'smooth'}); return false;" class="inline-flex items-center justify-center bg-white text-primary-600 px-6 py-3 rounded-lg font-semibold hover:bg-primary-50 transition-colors">
            View {cityName} Providers
          </a>
        ) : (
          <a href={`/${stateSlug}/`} class="inline-flex items-center justify-center bg-white text-primary-600 px-6 py-3 rounded-lg font-semibold hover:bg-primary-50 transition-colors">
            Browse {stateName} Cities
          </a>
        )}
        <a href="/calculator/" class="inline-flex items-center justify-center border-2 border-white text-white px-6 py-3 rounded-lg font-semibold hover:bg-primary-700 transition-colors">
          Calculate How Many You Need
        </a>
      </div>
    </div>

    <!-- Bottom Ad -->
    <div class="mt-8">
      <AdSlot slot="footer" />
    </div>
  </div>
</BaseLayout>
