---
import '../styles/global.css';
import Header from '../components/Header.astro';
import Footer from '../components/Footer.astro';
import SEOHead from '../components/SEOHead.astro';
import StructuredData from '../components/StructuredData.astro';
import siteConfig from '../data/site-config.json';

interface Props {
  title?: string;
  description?: string;
  ogImage?: string;
}

const {
  title = siteConfig.seoTitle || siteConfig.name,
  description = siteConfig.description,
  ogImage = '/og-image.png'
} = Astro.props;

// If title is the SEO title or site name, use as-is; otherwise append brand
const fullTitle = (title === siteConfig.seoTitle || title === siteConfig.name)
  ? title
  : `${title} | ${siteConfig.name}`;
const siteUrl = `https://${siteConfig.domain}`;

// Site-wide Organization schema
const organizationData = {
  name: siteConfig.name,
  url: siteUrl,
  logo: `${siteUrl}/images/PottyDirectory_Logo.png`,
  description: siteConfig.description,
  email: siteConfig.contact.email,
  sameAs: [
    siteConfig.social.facebook,
    siteConfig.social.twitter,
    siteConfig.social.instagram
  ].filter(Boolean),
  areaServed: {
    '@type': 'Country',
    name: 'United States'
  }
};

// WebSite schema with SearchAction for sitelinks search box
const websiteData = {
  name: siteConfig.name,
  url: siteUrl,
  description: siteConfig.description,
  potentialAction: {
    '@type': 'SearchAction',
    target: {
      '@type': 'EntryPoint',
      urlTemplate: `${siteUrl}/search?q={search_term_string}`
    },
    'query-input': 'required name=search_term_string'
  }
};
---

<!DOCTYPE html>
<html lang="en">
  <head>
    <SEOHead
      title={fullTitle}
      description={description}
      ogImage={ogImage}
    />
    <StructuredData type="Organization" data={organizationData} />
    <StructuredData type="WebSite" data={websiteData} />
  </head>
  <body class="min-h-screen flex flex-col">
    <Header />
    <main class="flex-grow">
      <slot />
    </main>
    <Footer />
  </body>
</html>
