---
import ProductCard from './ProductCard.astro';
import productsData from '../data/products.json';

interface Props {
  categoryId: string;
  limit?: number;
  title?: string;
  variant?: 'default' | 'compact' | 'horizontal';
}

const { categoryId, limit = 4, title, variant = 'compact' } = Astro.props;

// Get category info
const category = productsData.categories.find(c => c.id === categoryId);

// Get products for this category
const products = productsData.products
  .filter(p => p.category === categoryId)
  .slice(0, limit);

const displayTitle = title || (category ? `Recommended ${category.name}` : 'Recommended Products');
---

{products.length > 0 && (
  <div class="my-8 bg-gradient-to-r from-amber-50 to-orange-50 rounded-xl p-6 border border-amber-200">
    <div class="flex items-center justify-between mb-4">
      <div class="flex items-center gap-2">
        <svg class="w-5 h-5 text-amber-600" fill="currentColor" viewBox="0 0 20 20">
          <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z" />
        </svg>
        <h3 class="font-semibold text-gray-900">{displayTitle}</h3>
      </div>
      <a href="/supplies/" class="text-sm text-amber-700 hover:text-amber-800 font-medium">
        View all supplies &rarr;
      </a>
    </div>

    {variant === 'compact' && (
      <div class="grid grid-cols-1 sm:grid-cols-2 gap-3">
        {products.map(product => (
          <ProductCard product={product} variant="compact" />
        ))}
      </div>
    )}

    {variant === 'default' && (
      <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4">
        {products.map(product => (
          <ProductCard product={product} variant="default" />
        ))}
      </div>
    )}

    {variant === 'horizontal' && (
      <div class="space-y-4">
        {products.map(product => (
          <ProductCard product={product} variant="horizontal" />
        ))}
      </div>
    )}

    <p class="text-xs text-amber-700 mt-4">
      * Affiliate links - we may earn a commission at no extra cost to you
    </p>
  </div>
)}
